{{template "admin/layout_head" (dict "ctxData" . "pageClass" "admin monitor")}}
<div class="admin-setting-content">
	<h4 class="ui top attached header">
		{{.locale.Tr "admin.monitor.cron"}}
	</h4>
	<div class="ui attached table segment">
		<form method="post" action="{{AppSubUrl}}/admin">
			<table class="ui very basic table unstackable cron-table">
				<thead>
					<tr>
						<th>{{.locale.Tr "admin.monitor.name"}}</th>
						<th>{{.locale.Tr "admin.monitor.schedule"}}</th>
						<th>{{.locale.Tr "admin.monitor.next"}}</th>
						<th>{{.locale.Tr "admin.monitor.previous"}}</th>
						<th>{{.locale.Tr "admin.monitor.execute_times"}}</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					{{range .Entries}}
						<tr>
							<td class="cron-table__cell cron-table__cell_name cron-table__cell_status_{{.Status}}">
								<div class="cron-table__flex">
									{{ if eq .Status "process" }}
									<span class="cron-status-process">
										{{ svg "octicon-clock" }}
									</span>

									{{ else if eq .Status "finished"}}
									<span class="cron-status-finished">
										{{ svg "octicon-check" }}
									</span>

									{{ else if eq .Status "error"}}
									<span class="cron-status-error">
										{{ svg "octicon-alert" }}
									</span>

									{{ else if eq .Status "cancelled"}}
									<span class="cron-status-cancelled">
										{{ svg "octicon-circle-slash" }}
									</span>

									{{ else if eq .Status "registered"}}
									<span class="cron-status-registered">
										{{ svg "octicon-list-unordered" }}
									</span>
									{{ end}}

									<span>
										{{$.locale.Tr (printf "admin.dashboard.%s" .Name)}}
									</span>

									{{ if and .LastFailedRunMessage .LastFailedRun }}
										<button class="button cron-table__chevron-alert" data-tooltip-content="{{$.locale.Tr "admin.monitor.expand_message"}}">
												{{ svg "octicon-chevron-down" }}
										</button>
									{{ end }}
								</div>

							</td>
							<td class="cron-table__cell cron-table__cell_schedule">{{.Spec}}</td>
							<td class="cron-table__cell cron-table__cell_time-next">{{DateTime "narrow" .Next}}</td>
							<td class="cron-table__cell cron-table__cell_time-prev">{{if gt .Prev.Year 1}}{{DateTime "narrow" .Prev}}{{else}}-{{end}}</td>
							<td class="cron-table__cell cron-table__cell_execute-count">{{.ExecTimes}}</td>
							<td>
								<div class="cron-table__buttons">
									<button type="submit" class="button" data-tooltip-content="{{$.locale.Tr "admin.dashboard.operation_clear_status"}}" name="clear" value="{{.Name}}">{{svg "octicon-reload"}}</button>
									<button type="submit" class="button" data-tooltip-content="{{$.locale.Tr "admin.dashboard.operation_run"}}" name="op" value="{{.Name}}">{{svg "octicon-player-play"}}</button>
									<button type="submit" class="button" data-tooltip-content="{{$.locale.Tr "admin.dashboard.operation_force_run"}}" name="force" value="{{.Name}}">{{svg "octicon-player-next"}}</button>
								</div>
							</td>
						</tr>


						{{ if and .LastFailedRunMessage .LastFailedRun   }}
						<tr class="cron-table__row_alert">
							<td colspan="6" class="cron-table__cell_alert">
								<div class="cron-alert">
									<div class="cron-alert__time">{{ DateTime "full" .LastFailedRun }}</div>
									<div class="cron-alert__text">
										{{ .LastFailedRunMessage }}
									</div>
								</div>
							</td>
						</tr>
						{{end}}

					{{end}}
				</tbody>
			</table>
			<input type="hidden" name="from" value="monitor">
			{{.CsrfTokenHtml}}
		</form>
	</div>
</div>
{{template "admin/layout_footer" .}}
