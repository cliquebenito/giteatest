<div class="header-wrapper">
{{with .Repository}}
	<div class="container ui">
		<script>
			window.config.OWProjectReposCount = {{.Owner.NumRepos}};
			window.config.OWProjectName = {{.Owner.LowerName}};
			// window.localStorage.setItem('OWProjectName', {{.Owner.Name}});
		</script>
		<div class="repo-header">
			<div class="repo-title-wrap">
				<div class="repo-title-container" role="heading" aria-level="1">
					{{$avatar := (repoAvatar . 32 "gt-mr-3")}}
					{{if $avatar}}
						{{$avatar}}
					{{else}}
						{{template "repo/icon" .}}
					{{end}}

					<h1 class="repo-title">
						<a class="repo-title__link"  href="{{.Owner.HomeLink}}">{{.Owner.Name}}</a>
						<span class="repo-title__divider">/</span>
						<a class="repo-title__link" href="{{$.RepoLink}}">{{.Name}}</a>
					</h1>
					{{if .IsTemplate}}
						{{if .IsPrivate}}
							<div class="sc-badge sc-badge_outlined">
								{{$.locale.Tr "repo.desc.private_template"}}
							</div>
						{{else}}
							{{if .Owner.Visibility.IsPrivate}}
								<div class="sc-badge sc-badge_outlined">
									{{$.locale.Tr "repo.desc.internal_template"}}
								</div>
							{{end}}
						{{end}}
					{{else}}
						{{if .IsPrivate}}
							<div class="sc-badge sc-badge_outlined">
								{{$.locale.Tr "repo.desc.private"}}
							</div>
						{{else}}
							{{if .Owner.Visibility.IsPrivate}}
								<div class="sc-badge sc-badge_outlined">
									{{$.locale.Tr "repo.desc.internal"}}
								</div>
							{{end}}
						{{end}}
					{{end}}
					{{if .IsArchived}}
						<div class="sc-badge sc-badge_outlined">
							{{$.locale.Tr "repo.desc.archived"}}
						</div>
					{{end}}
					{{if $.EnableFeed}}
						<a class="rss-icon gt-ml-3" href="{{$.RepoLink}}.rss" data-tooltip-content="{{$.locale.Tr "rss_feed"}}">{{svg "octicon-rss" 18}}</a>
					{{end}}
					{{if CodeHubMarkEnabled}}
							{{range .RepoMarks}}
								<span class="sc-badge sc-badge_positive">{{.Label}}</span>
							{{end}}
					{{end}}
				</div>
				{{if $.PullMirror}}
					{{$address := MirrorRemoteAddress $.Context . $.PullMirror.GetRemoteName false}}
					<div class="fork-flag">{{$.locale.Tr "repo.mirror_from"}} <a target="_blank" rel="noopener noreferrer" href="{{$address.Address}}">{{$address.Address}}</a></div>
				{{end}}
				{{if .IsFork}}<div class="fork-flag">{{$.locale.Tr "repo.forked_from"}} <a href="{{.BaseRepo.Link}}">{{.BaseRepo.FullName}}</a></div>{{end}}
				{{if .IsGenerated}}<div class="fork-flag">{{$.locale.Tr "repo.generated_from"}} <a href="{{.TemplateRepo.Link}}">{{.TemplateRepo.FullName}}</a></div>{{end}}
			</div>
			{{if not (or .IsBeingCreated .IsBroken)}}
				<div class="repo-buttons">
					{{if $.RepoTransfer}}
						<form method="post" action="{{$.RepoLink}}/action/accept_transfer?redirect_to={{$.RepoLink}}">
							{{$.CsrfTokenHtml}}
							<div data-tooltip-content="{{if $.CanUserAcceptTransfer}}{{$.locale.Tr "repo.transfer.accept_desc" $.RepoTransfer.Recipient.DisplayName}}{{else}}{{$.locale.Tr "repo.transfer.no_permission_to_accept"}}{{end}}">
								<button type="submit" class="ui basic button {{if $.CanUserAcceptTransfer}}green {{end}} ok small"{{if not $.CanUserAcceptTransfer}} disabled{{end}}>
									{{$.locale.Tr "repo.transfer.accept"}}
								</button>
							</div>
						</form>
						<form method="post" action="{{$.RepoLink}}/action/reject_transfer?redirect_to={{$.RepoLink}}">
							{{$.CsrfTokenHtml}}
							<div data-tooltip-content="{{if $.CanUserAcceptTransfer}}{{$.locale.Tr "repo.transfer.reject_desc" $.RepoTransfer.Recipient.DisplayName}}{{else}}{{$.locale.Tr "repo.transfer.no_permission_to_reject"}}{{end}}">
								<button type="submit" class="ui basic button {{if $.CanUserAcceptTransfer}}red {{end}}ok small"{{if not $.CanUserAcceptTransfer}} disabled{{end}}>
									{{$.locale.Tr "repo.transfer.reject"}}
								</button>
							</div>
						</form>
					{{end}}

					<form method="post" action="{{$.RepoLink}}/action/{{if $.IsWatchingRepo}}un{{end}}watch?redirect_to={{$.Link}}">
						{{$.CsrfTokenHtml}}
						<div class="sc-button sc-button_counter sc-button_small" {{if not $.IsSigned}}data-tooltip-content="{{$.locale.Tr "repo.watch_guest_user"}}"{{end}}>
							<button class="sc-button__container" {{if not $.IsSigned}} disabled{{end}}>
								<span class="sc-button__icon">
									{{if $.IsWatchingRepo}}{{svg "octicon-eye-closed" 16}}{{else}}{{svg "octicon-eye"}}{{end}}
								</span>
									{{if $.IsWatchingRepo}}{{$.locale.Tr "repo.unwatch"}}{{else}}{{$.locale.Tr "repo.watch"}}{{end}}
							</button>
							<a class="sc-badge sc-badge_info" href="{{.Link}}/watchers">
								{{CountFmt .NumWatches}}
							</a>
						</div>
					</form>

					{{if not $.DisableStars}}
						<form method="post" action="{{$.RepoLink}}/action/{{if $.IsStaringRepo}}un{{end}}star?redirect_to={{$.Link}}">
							{{$.CsrfTokenHtml}}
							<div class="sc-button sc-button_counter sc-button_small" {{if not $.IsSigned}}data-tooltip-content="{{$.locale.Tr "repo.star_guest_user"}}"{{end}}>
								<button class="sc-button__container" {{if not $.IsSigned}} disabled{{end}}>
									<span class="sc-button__icon">
										{{if $.IsStaringRepo}}{{svg "octicon-star-fill"}}{{else}}{{svg "octicon-star"}}{{end}}
									</span>
									{{if $.IsStaringRepo}}{{$.locale.Tr "repo.unstar"}}{{else}}{{$.locale.Tr "repo.star"}}{{end}}
								</button>
								<a class="sc-badge sc-badge_info" href="{{.Link}}/stars">
									{{CountFmt .NumStars}}
								</a>
							</div>
						</form>
					{{end}}

					{{if and (not .IsEmpty) ($.Permission.CanRead $.UnitTypeCode) (and $.CanSignedUserFork)}}
						<div class="sc-button sc-button_counter sc-button_small
							{{if or (not $.IsSigned) (and (eq (len $.UserAndOrgForks) 0))}}
								disabled
							{{end}}"
							{{if not $.IsSigned}}
								data-tooltip-content="{{$.locale.Tr "repo.fork_guest_user"}}"
							{{else if and (not $.CanSignedUserFork) (eq (len $.UserAndOrgForks) 0)}}
								data-tooltip-content="{{$.locale.Tr "repo.fork_from_self"}}"
							{{end}}
						>
							<a class="{{if $.ShowForkModal}} show-modal{{end}} sc-button__link"
								{{if not $.CanSignedUserFork}}
									{{if gt (len $.UserAndOrgForks) 1}}
										data-modal="#fork-repo-modal"
									{{else if eq (len $.UserAndOrgForks) 1}}
										href="{{AppSubUrl}}/{{(index $.UserAndOrgForks 0).FullName}}"
									{{/*else is not required here, because the button shouldn't link to any site if you can't create a fork*/}}
									{{end}}
								{{else if eq (len $.UserAndOrgForks) 0}}
									href="{{AppSubUrl}}/repo/fork/{{.ID}}"
								{{else}}
									data-modal="#fork-repo-modal"
								{{end}}
							>
								<span class="sc-button__icon">
									{{svg "octicon-repo-forked"}}
								</span>
								{{$.locale.Tr "repo.fork"}}
							</a>
							<div class="ui small modal" id="fork-repo-modal">
								<div class="header">
									{{$.locale.Tr "repo.already_forked" .Name}}
								</div>
								<div class="content gt-tl">
									<div class="ui list">
										{{range $.UserAndOrgForks}}
											<div class="ui item gt-py-3">
												<a href="{{.Link}}">
													{{svg "octicon-repo-forked" 16 "gt-mr-3"}}{{.FullName}}
												</a>
											</div>
										{{end}}
									</div>
									{{if $.CanSignedUserFork}}
									<div class="ui divider"></div>
									<a href="{{AppSubUrl}}/repo/fork/{{.ID}}">
										{{$.locale.Tr "repo.fork_to_different_account"}}
									</a>
									{{end}}
								</div>
							</div>
							<a class="sc-badge sc-badge_info" href="{{.Link}}/forks">
								{{CountFmt .NumForks}}
							</a>
						</div>
					{{end}}
				</div>
			{{end}}
		</div><!-- end grid -->
	</div><!-- end container -->
{{end}}
	<div class="container ui tabs">
		{{if not (or .Repository.IsBeingCreated .Repository.IsBroken)}}
			<div class="sc-tabs-nav">
				{{if .Permission.CanRead $.UnitTypeCode}}
				<a class="{{if .PageIsViewCode}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item" href="{{.RepoLink}}{{if (ne .BranchName .Repository.DefaultBranch)}}/src/{{.BranchNameSubURL}}{{end}}">
					{{svg "octicon-code"}} {{.locale.Tr "repo.code"}}
				</a>
				{{end}}

				{{if and (.Permission.CanRead $.UnitTypeIssues) (not .OneWork.Enabled )}}
					<a class="{{if .PageIsIssueList}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item" href="{{.RepoLink}}/issues">
						{{svg "octicon-issue-opened"}} {{.locale.Tr "repo.issues"}}
						{{if .Repository.NumOpenIssues}}
							<span class="sc-badge sc-badge_info">{{CountFmt .Repository.NumOpenIssues}}</span>
						{{end}}
					</a>
				{{end}}

				{{if and (.Permission.CanRead $.UnitTypeExternalTracker) (not .OneWork.Enabled )}}
					<a class="{{if .PageIsIssueList}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item" href="{{.RepoExternalIssuesLink}}" target="_blank" rel="noopener noreferrer">
						<span>{{svg "octicon-link-external"}} {{.locale.Tr "repo.issues"}} </span>
					</a>
				{{end}}

				{{if and .Repository.CanEnablePulls (.Permission.CanRead $.UnitTypePullRequests)}}
					{{if CheckPrivileges $.TraceID $.TraceEndpoint $.SignedUser.ID $.TenantID .Owner.ID "read"}}
						<a class="{{if .PageIsPullList}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item" href="{{.RepoLink}}/pulls">
							{{svg "octicon-git-pull-request"}} {{.locale.Tr "repo.pulls"}}
							{{if .Repository.NumOpenPulls}}
							<span class="sc-badge sc-badge_info">{{CountFmt .Repository.NumOpenPulls}}</span>
							{{end}}
						</a>
					{{else if CheckPrivilegesByRoleAndCustom $.TraceID $.TraceEndpoint $.SignedUser.ID $.TenantID .Owner.ID .Repository.ID "viewPR" }}
							<a class="{{if .PageIsPullList}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item" href="{{.RepoLink}}/pulls">
								{{svg "octicon-git-pull-request"}} {{.locale.Tr "repo.pulls"}}
								{{if .Repository.NumOpenPulls}}
									<span class="sc-badge sc-badge_info">{{CountFmt .Repository.NumOpenPulls}}</span>
								{{end}}
							</a>
					{{ end }}
				{{end}}
				{{if and .EnableActions (not .UnitActionsGlobalDisabled) (.Permission.CanRead $.UnitTypeActions)}}
					<a class="{{if .PageIsActions}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item" href="{{.RepoLink}}/actions">
						{{svg "octicon-play"}} {{.locale.Tr "actions.actions"}}
						{{if .Repository.NumOpenActionRuns}}
							<span class="sc-badge sc-badge_info">{{CountFmt .Repository.NumOpenActionRuns}}</span>
						{{end}}
					</a>
				{{end}}

				{{if and (not .UnitProjectsGlobalDisabled) (.Permission.CanRead $.UnitTypeProjects) (not .OneWork.Enabled) }}
					<a href="{{.RepoLink}}/projects" class="{{if .IsProjectsPage}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item">
						{{svg "octicon-project"}} {{.locale.Tr "repo.project_board"}}
						{{if .Repository.NumOpenProjects}}
							<span class="sc-badge sc-badge_info">{{CountFmt .Repository.NumOpenProjects}}</span>
						{{end}}
					</a>
				{{end}}

				{{if and (.Permission.CanReadAny $.UnitTypePullRequests $.UnitTypeIssues $.UnitTypeReleases) (not .IsEmptyRepo)}}
					<a class="{{if .PageIsActivity}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item" href="{{.RepoLink}}/activity">
						{{svg "octicon-pulse"}} {{.locale.Tr "repo.activity"}}
					</a>
				{{end}}

				{{template "custom/extra_tabs" .}}
				{{if EnableRoleModel }}
					{{if and .Owner.ID (CheckPrivileges .TraceID .TraceEndpoint .SignedUser.ID .TenantID .Owner.ID "edit")}}
						<a class="{{if .PageIsRepoSettings}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item_pin-right sc-tabs-nav__item" href="{{.RepoLink}}/settings">
							{{svg "octicon-tools"}} {{.locale.Tr "repo.settings"}}
						</a>
					{{end}}
				{{else}}
					{{if .Permission.IsAdmin}}
						<a class="{{if .PageIsRepoSettings}}sc-tabs-nav__item_active {{end}}sc-tabs-nav__item_pin-right sc-tabs-nav__item" href="{{.RepoLink}}/settings">
								{{svg "octicon-tools"}} {{.locale.Tr "repo.settings"}}
						</a>
					{{end}}
				{{end}}
			</div>
		{{else if CheckPrivilegesByRoleAndCustom .TraceID .TraceEndpoint .SignedUser.ID .TenantID .Owner.ID .Repository.ID "viewPR"}}
			<div class="ui tabular menu navbar gt-overflow-x-auto gt-overflow-y-hidden">
				<a class="{{if .PageIsRepoSettings}}active {{end}}right item" href="{{.RepoLink}}/settings">
					{{svg "octicon-tools"}} {{.locale.Tr "repo.settings"}}
				</a>
			</div>
		{{end}}
	</div>
</div>
